# Makefile for MPIP	-*-Makefile-*-
# Copyright (C) 2001 Jeffrey Vetter vetter3@llnl.gov
# $Header$
# @configure_input@

srcdir=@srcdir@
exclude_mpi_io_tests=@DISABLE_MPI_IO@
VPATH = $(srcdir)

include ../Defs.mak

CFLAGS	+= -I..
LDFLAGS	+= -L..
CXXLIBS	:= -l$(MPIPCXXLIB) $(LIBS) $(CXXLIBS)
FLIBS	:= -l$(MPIPFLIB) $(LIBS)
API_LIBS := -lmpiPapi $(LIBS)
LIBS	:= -lmpiP $(LIBS)
CPPFLAGS =

CSRCS =	0-simple.c \
	0-simple-c++.C \
	1-hot-potato.c \
	2-pcontrol.c \
	3-stacktrace.c \
	4-demangle.C \
	5-medley.c \
	6-nonblock.c \
	7-nonblock-waitall.c \
	8-test.c \
	9-test-mpip-time.c \
	10-coll-mess-size.c \
	11-p2p-mess-size.c \
	12-null-null.c \
	13-pcontrol-report.c \
	15-pcontrol.c \
	timer-info.c

ifeq (${exclude_mpi_io_tests},no)
CSRCS = 14-mpiio.c
endif

FSRCS =	0-simplef.f sweep-ops.f sweep-ops-stack.f 16-waitallf.f 
API_SRCS = api-test.c

ifneq ($(ENABLE_API_ONLY),yes)
TEXES = $(CSRCS:.c=.exe)
EXES = $(TEXES:.C=.exe)
EXES += $(FSRCS:.f=.exe)
EXES += $(API_SRCS:.c=.exe)
else
EXES = $(API_SRCS:.c=.exe)
endif

all: ${EXES}
	@echo All done.

.SUFFIXES: .exe
.c.exe::
	${CC} ${CFLAGS} ${CPPFLAGS} $< -o $@ ${LDFLAGS} ${LIBS}

.C.exe:
	${CXX} ${CFLAGS} ${CPPFLAGS} $< -o $@ ${LDFLAGS} ${CXXLIBS}

.f.exe:
	${FC} ${FFLAGS} ${CPPFLAGS} $< -o $@ ${LDFLAGS} ${FLIBS}

api-test.exe :: LIBS=$(API_LIBS)

clean::
	rm -f ${EXES} *.mpiP *.o

include $(srcdir)/../Rules.mak

##### EOF
